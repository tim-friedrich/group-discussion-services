<% title 'Diskussion' %>

<div id="discussion">
  <div class="toolbox"></div>

  <div id="moderator">
    <div id="question"></div>
    <div id="moderator_show">
      <%= image_tag(@discussion.moderator_avatar, size: "60x60", alt: "Bild des Moderators") %>
    </div>
  </div>

  <div class="chat_container">

    <div id="chat">
      <div id="arguments"></div>
    </div>

    <%= form_for Argument.new, role: "form", remote: true do |f| %>
      <div class="form-group">
    	<div class="emoticon_picker"><span class="emoticon emoticon-smile" title="Smiley hinzufÃ¼gen">:)</span>
          <div class="emoticon_prev" ></div>
        </div>
        <div contentEditable="true" class="form-control" id="new_argument_content"></div>

      </div>
      <%= f.hidden_field :discussion_id, value: @discussion.id %>
      <div id="submit_buttons">
        <% if @discussion.moderator == current_user %>
          <div class="btn-group">
            <button type="button" class="btn btn-default" id="new_argument_button">Senden</button>
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li><a href="javascript:void(0);" id="new_question_button">Neue Frage</a></li>
              <li><a href="javascript:void(0);" id="new_observer_argument_button">An Beobachter senden</a></li>
            </ul>
          </div>
        <% else %>
          <%= f.submit "Senden" , class: "btn btn-success", id: "new_argument_button" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<% content_for :late_assets do %>
  <%= subscribe_to "/discussion/#{@discussion.id}/arguments/new" %>
  <% if current_user == @discussion.moderator || @discussion_user.role.name == 'observer' %>
    <%= subscribe_to "/discussion/#{@discussion.id}/observer/arguments/new" %>
  <% end %>
  <%= subscribe_to "/discussion/#{@discussion.id}/questions/new" %>
  <%= subscribe_to "/discussion/#{@discussion.id}/visualAid/open" %>
  <%= subscribe_to "/discussion/#{@discussion.id}/visualAid/close" %>
  <%= subscribe_to "/discussion/#{@discussion.id}/votes/new" %>
  <%= subscribe_to "/discussion/#{@discussion.id}/users/new" %>
  <%= subscribe_to "/discussion/#{@discussion.id}/users/enter" %>
  <%= subscribe_to "/discussion/#{@discussion.id}/users/leave" %>
  <%= subscribe_to "/discussion/#{@discussion.id}/visualAid/command" %>
  <% unless current_user == @discussion.moderator %>
    <%= subscribe_to "/discussion/#{@discussion.id}/state/close" %>
  <% end %>
<% end %>

<% content_for :javascript do %>
  $(document).ready(function(){ new Discussion(); });
<% end %>
