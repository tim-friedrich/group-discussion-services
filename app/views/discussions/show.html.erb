<div class="panel panel-default">
  <div class="panel-heading">
      <h3 class="panel-title">Frage: <%= @questions.last.topic %></h3>
    </div>
  
     <div class="moderator_show">
        <h5><%= @discussion.moderator.firstName+" "+@discussion.moderator.surname %></h5>
        <%= image_tag('Unknown-person.gif', size: "80x80", alt: "Bild des Moderators") %>
      </div>
  
    <ul class="list-group" id="moderator_chat">
      <% @questions.each do |question| %> 
        <% question.arguments.each do |argument| %>
        <% if argument.argument_type == @type_moderator%>
            <div class="list-group-item">
              <%= render argument %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </ul>
</div>

<div class="panel panel-default" id="discussion_panel">
  <ul class="list-group" id="discussion">
  	<% @questions.each do |question| %> 
	    <% question.arguments.each do |argument| %>
       <% if argument.argument_type == @type_proband %>
	       <div class="list-group-item">
	         <%= render argument %>
	       </div>
        <% end %>
	    <% end %>
    <% end %>
    </ul>
</div>

<%= render 'arguments/new' %>



<script src=" https://d3dy5gmtp8yhk7.cloudfront.net/2.1/pusher.min.js"></script>
<script>
  
  $( "#new_argument" ).click(function( event ) {
    $( "#new_argument" ).submit();
    $('#argument_content').val('');
  });
  
  var pusher = new Pusher('<%= Pusher.key %>'); // uses your API KEY
     
  Pusher.log = function(message) {
    if (window.console && window.console.log) {
      window.console.log(message);
      }
    };
  var channel = pusher.subscribe('discussion<%= @discussion.id.to_s %>');
  channel.bind('newargument', function(data){
    if(data.argument_type == 'proband'){
      var discussion = document.getElementById("discussion");
    }
    if(data.argument_type == 'moderator'){
      var discussion = document.getElementById("moderator_chat");
    }
    var container = document.createElement("div");
    var argument = document.createElement("div");
    var time = document.createElement("div");

    container.setAttribute("class", "list-group-item");
    argument.setAttribute("class", "argument");
    time.setAttribute("class", "time_stamp");
    argument.innerHTML = data.firstname + ": " + data.argument;
    time.innerHTML = data.created_at;
    container.appendChild(argument);
    container.appendChild(time);
    discussion.appendChild(container);
    
    discussion.scrollTop = discussion.scrollHeight;
  });

</script>





